#!/bin/bash

# RPM_BUILD="$(pwd)/rpmbuild"
# mkdir -p "${RPM_BUILD}"

VERSION='20.0.0'
RELEASE=$(date +%Y%m%d%H%M)

sed "s/{VERSION}/${VERSION}/" setup.py.template > setup.py

RPM_HOME="/home/rpm"

pdoc3 --html --force -o msa_sdk/html msa_sdk

mkdir -p rpms/
docker run --rm -u rpm -v "$(pwd):${RPM_HOME}/build" \
    -w "${RPM_HOME}/build" rpm-build \
    python3 setup.py bdist_rpm --release="${RELEASE}" \
    --binary-only \
    --dist-dir rpms/

rm -rf build/ dist/ msa_sdk.egg-info/
